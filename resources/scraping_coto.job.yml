resources:
  jobs:
    # Cada job por ter várias tasks
    scraping_coto_job:
      name: scraping_coto_job

      trigger:
        periodic:
          interval: 1
          unit: DAYS

      email_notifications:
       on_failure:
        - ${workspace.current_user.userName}

      # Definindo parâmetros globais para o Job
      # parameters:
      #   - name: LOGFIRE_TOKEN
      #     default: ${var.LOGFIRE_TOKEN}
      
      tasks:
        # Task para validar se os volumes e catálogos existem
        - task_key: validate_volumes
          notebook_task:
            notebook_path: ../src/check_volumes.ipynb
            base_parameters:
              target: ${bundle.target}
              source_path: ${workspace.file_path}/src

        # Carrega dados nos volumes de staging dentro do schema Bronze
        - task_key: load_staging_data
          depends_on:
            - task_key: validate_volumes
          notebook_task:
            notebook_path: ../src/load_staging.ipynb
            # base_parameters:
            #   LOGFIRE_TOKEN: ${var.LOGFIRE_TOKEN}
        
        # Lê os volumes e cria tabelas delta na camada bronze
        - task_key: staging_to_bronze
          depends_on:
            - task_key: load_staging_data
          notebook_task:
            notebook_path: ../src/staging_to_bronze.ipynb
            # base_parameters:
            #   LOGFIRE_TOKEN: ${var.LOGFIRE_TOKEN}

      # Especificações de ambiente (pesquisar mais)
      environments:
        - environment_key: default
          spec:
            client: "2"
            dependencies:
              - ../dist/*.whl